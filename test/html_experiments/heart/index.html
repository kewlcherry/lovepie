<html>
<head>
<link rel="stylesheet" type="text/css" href="styles.css">
<link rel="stylesheet" type="text/css" href="reset.css">
<link rel="Stylesheet" type="text/css" href="jquery-ui/css/smoothness/jquery-ui-1.7.2.custom.css" />
<script type="text/javascript" src="jquery-ui/js/jquery-1.3.2.min.js"></script>
<script type="text/javascript" src="jquery-ui/js/jquery-ui-1.7.2.custom.min.js"></script>
<script>
$(document).ready(function () {

	var containerHeight = $("ul#invisible-overlay").height();
	var heartItems = $('ul#invisible-overlay');
	var currentItemIndex = 0;
	var lastIndex = 0;
	var minSliceSize = 30;
	var initialSizeOfSlice = 0;
	var bottomOfContainer = 313;
	var lastHeightSubtraction = 0;

	$("#invisible-overlay li.one").resizable({ containment: '#invisible-overlay', alsoResize: '#beneath-image li.one', maxWidth: 699, minWidth: 699, minHeight: 30 });
	$("#invisible-overlay li.two").resizable({ containment: '#invisible-overlay', alsoResize: '#beneath-image li.two', maxWidth: 699, minWidth: 699, minHeight: 30});	
	$("#invisible-overlay li.three").resizable({ containment: '#invisible-overlay', alsoResize: '#beneath-image li.three', maxWidth: 699, minWidth: 699, minHeight: 30});
	
	$("#invisible-overlay li").resize(function(){
		$.fn.adjustLastElements();
	});	

	$.fn.getFirstResizableIndex = function(listObj) {
		var index = listObj.length;
		
		do {
			console.log("looping index is " + index -1 + "height =" + listObj.get(index -1));
			if(listObj.get(index -1).height() > minSliceSize){
				return index;
			}
			index--;
		} while (index > 0);
		return -1;		
	}

//	$.fn.adjustLastElements = function() {
		
//		// $("#beneath-image li").getIndexOfLastElementWithHeightGreaterThanMinSlice
//		var index = $.fn.getFirstResizableIndex($("#beneath-image li"));
		
//		if($("#beneath-image li:last").height() != minSliceSize){
//			var allButLastElementHeight = parseInt($("#beneath-image li:last").prev().position().top) + parseInt($("#beneath-image li:last").prev().height())
//			var diff = containerHeight - allButLastElementHeight;	
//			$("#beneath-image li:last, #invisible-overlay li:last").height(diff);				
//		}
//	}

	$.fn.adjustLastElements = function() {
		
		if($("#beneath-image li:last").height() != minSliceSize){
			var allButLastElementHeight = parseInt($("#beneath-image li:last").prev().position().top) + parseInt($("#beneath-image li:last").prev().height())
			var diff = containerHeight - allButLastElementHeight;	
			$("#beneath-image li:last, #invisible-overlay li:last").height(diff);				
		}else{
			
		}
	}


/*
*	The max height is the furthest point down this element could be pulled
*	including the previous and following slices.
*
*/
	$.fn.findMax = function() {
		var maxHeight = 0;					
		jQuery.each($('ul#invisible-overlay li').slice(0, currentItemIndex), function() {
		      maxHeight =  maxHeight + $(this).height() ;
		});
		
	  	var minPossHeightOfFollowers =   lastIndex - currentItemIndex;
		minPossHeightOfFollowers = minPossHeightOfFollowers * minSliceSize;
		maxHeight = maxHeight + minPossHeightOfFollowers;
				
		$('#invisible-overlay li').resizable('option', 'maxHeight', (containerHeight - maxHeight));
	}
			
	$('#invisible-overlay li').bind('resizestart', function(event, ui) {
		currentItemIndex = $(this).parent().children().index( this )
		$last = $('ul#invisible-overlay li:last');
	  	lastIndex = $(this).parent().children().index( $last );
		initialSizeOfSlice = $(this).height();
	
		$.fn.findMax();
	});	
	
	
});
</script>
</head>
<body>
	<div id="giving-pool">
		<ul id="invisible-overlay">
			<li class="one">one</li>
			<li class="two">two</li>
			<li class="three">three</li>
			<li class="four">four</li>
		</ul>
		<ul id="beneath-image">
			<li class="one">one</li>
			<li class="two">two</li>
			<li class="three">three</li>
			<li class="four">four</li>
		</ul>	
	<div>
</body>
</html>